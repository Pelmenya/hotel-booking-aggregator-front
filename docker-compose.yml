version: "3.9"
services: 
  hotel-aggregator-front:
    build: ./
    container_name: hotel-aggregator-front
    volumes:
      - .:/app
    ports:
      - ${PORT}:${PORT_IN}
    working_dir: /app
    env_file: 
      - .env.production  # Используем файл .env.production
    environment:      
      - PORT=${PORT}
      - NODE_ENV=production
      - NEXT_PUBLIC_SITE_URL=${NEXT_PUBLIC_SITE_URL}
      - NEXT_PUBLIC_BASE_PICTURES_URL=${NEXT_PUBLIC_BASE_PICTURES_URL}
      - NEXT_PUBLIC_BASE_API_URL=${NEXT_PUBLIC_BASE_API_URL}
      - NEXT_PUBLIC_BASE_VIDEO_URL=${NEXT_PUBLIC_BASE_VIDEO_URL}
      - NEXT_PUBLIC_BASE_IMAGES_URL=${NEXT_PUBLIC_BASE_IMAGES_URL}
      - NEXT_PUBLIC_YM_ACCOUNT=${NEXT_PUBLIC_YM_ACCOUNT}
      - NEXT_PUBLIC_YM_API_KEY=${NEXT_PUBLIC_YM_API_KEY}
      - NEXT_PUBLIC_MAX_FILES_SIZE=${NEXT_PUBLIC_MAX_FILES_SIZE}
      - NEXT_PUBLIC_MAX_FILES=${NEXT_PUBLIC_MAX_FILES}

  command: sh -c "cd /app; rm -rf node_modules; rm -rf .next; npm install --force; npm run build; npm run start"
